version: '3.8'

networks:
  app:

volumes:
  database:
  wheeldir:

services:
  app:
    image: btquanto:python3-focal
    build:
      context: ./_docker/python3-focal
      dockerfile: Dockerfile
    networks:
      - app
    environment:
      - DEBUG=true
      - FLASK_ENV=development
      - FLASK_APP=/src/application/application.py
    ports:
      - 5000:5000
    volumes:
      - ./src:/src
      - ./_scripts:/scripts:ro
      - wheeldir:/wheeldir
    command: ["/bin/bash", "/scripts/flash.sh"]
  postgres:
    image: postgres:12.4-alpine
    networks:
      - app
    environment:
      - POSTGRES_USER=app
      - POSTGRES_DB=app
      - POSTGRES_PASSWORD=mysecretpassword
    volumes:
      - database:/var/lib/postgresql/data
  # nginx:
  #   image: nginx:1.19.2-alpine
  #   networks:
  #     - app
  #   ports:
  #     - 8080:9090
  #   volumes:
  #     - ./:/src
  #     - ./_scripts/nginx.conf:/etc/nginx/conf.d/nginx.conf:ro
  #   command: ["nginx", "-g", "daemon off;"]